---
title: "[게임수학] 곡선"
date: 2025-09-29 
categories: [Study, Game Mathematics]
tags: [Game Engineering, Game Mathematics, Unity, Unreal,  curve, 게임공학, 게임수학, 유니티, 언리얼, 곡선]
series: "[게임수학]"
series_order : 7
pin: false
math: true
image:
  path: https://imgur.com/lUpsAQ9.jpg
---

## 1. 곡선을 둘러싼 개념

---

- 절차적 생성(procedural generation)
  - 입력으로서의 제어점(control point)로 컴퓨터가 적당히 계산해 보간하고 제어점을 통과하는 자연스러운 형태의 선이 그어짐
  
- 보간과 근사
  - 보간
    - 두 개의 서로 다른 물체가 있을 때 그 중간을 어떻게 만들어 갈 것인지에 관해, 시점에 가까우면 시점의 속성을 더 강하게 반영하고 반대로 종점에 가까우면 종점의 속성을 강하게 반영함
    - 선형보간일 때 다음 식에서 $t$를 서서히 변화시킴으로써 $y_0$과 $y_1$ 중 어느 쪽 속성을 강하게 반영할 것인지에 관한 혼합 비율을 나타냄
  
      $$
      y=(1-t)y_0+ty_1
      $$
  
  - 근사
    - 제어점 자체를 느슨한 기준으로 삼아 대체로 비슷한 경로를 만들어냄으로써 전체적으로 자연스러운 형태의 곡선을 얻는 방법
    - 완성된 곡선은 반드시 제어점을 통과하지 않고 곡선의 형태에 영향을 주는 것에 불과함
  - 곡선 알고리즘을 선택할 때 사용할 알고리즘이 보간인지 근사인지는 특성을 이해하고 선택
  
- 매개변수 함수(parametrix function)
  1. 양함수(explicit function)
      - 일반적인 형식의 함수로, $x$ 값에 대해 단 하나의 $y$ 값을 가지는 함수
      - 단위원의 경우 직교 좌표계에서 $x$ 값에 대한 $y$ 값이 2개가 필요하므로 극좌표계 등 다른 좌표계로 바꾸어야하는 것처럼 양함수로 표현할 수 없는 곡선이 존재
  2. 음함수(implicit function)
      - 대수기하학에서 자주 사용되는 형식인 $f(x,y)=0$의 함수
      - 단위원의 경우 $x^2+y^2-1=0$으로 나타내며 $f(x,y,z)=0$으로 하면, 곡면을 나타내므로 3차원 곡선은 한 개의 식으로 표현할 수 없음
  - 양함수와 음함수 둘 다 데카르트 방정식(Cartesian equations) 종류의 방정식이지만, 매개변수 함수는 그 자체로 다른 장르임
  - 매개변수 함수는 매개변수 $t$를 매개로 복수의 양함수를 다시 표현하고, $x, y$ 등 원래 한 개의 식 안에 있던 성분을 따로 분리해 성분별로 표시
  - 매개변수 함수 $f$와 매개변수 $t$를 사용하면, 곡선은 다음과 같음
  
  $$
  \begin{aligned}
  f(t)&=(f_x(t),f_y(t))\\
  f(t)&=(f_x(t),f_y(t),f_z(t))
  \end{aligned}
  $$
  
  - 매개변수 곡선(Parametric Curve)
    - 매개변수 $t$의 1차원 정의역(domain)을 2D 평면상이나 3D 공간 내의 곡선에 사상하는 것
    - 몇 차원이라도 대응할 수 있고 모든 종류의 곡선을 표현할 수 있음
    - 게임에서 모든 곡선을 표현할 때 사용

- 다항식(polynomial)
  - 매개변수 곡선을 나타내는 식은 다음 $n$차 다항식의 형식과 같음
  
      $$
      P(t)=c_0+c_1t+c_2t^2+\cdots+c_nt^n=\sum_{k=0}^nc_kt^k
      $$
  
      1. $t$는 변수(variable)이고 $c_0,c_1$과 같은 상수(constant)는 계수(coefficient)라고 함
      2. 상수 또는 계수와 변수 $t$의 조합은 항(term)이라 하고 항이 하나인 식을 단항식(monomial)이라 함
      3. $n$은 다항식 전체의 차수(degree)라고 함
  - 매개변수 곡선의 다항식의 행렬 표현은 다음과 같음
  
      $$
      P(t)=\begin{bmatrix}
      t^n&\cdots&t^1&t^0
      \end{bmatrix}
      \begin{bmatrix}
      c_n\\
      \vdots\\
      c_1\\
      c_0
      \end{bmatrix}=
      \sum_{k=0}^nc_kt^k
      $$
  
  - $n$차 다항식은 $n+1$의 자유도를 가짐
  - 곡선 맞춤(curve fitting)
    - $n$차 다항식에 대해 $\begin{bmatrix}
    t_0&\cdots&t_n
    \end{bmatrix}$에 대응하는 $n+1$개의 다른 값(제어점의 좌표) $\begin{bmatrix}
    p_0&\cdots&p_n
    \end{bmatrix}$을 알면, $n$차 다항식을 나타내는 곡선의 계수 $\begin{bmatrix}
    c_0&\cdots&c_n
    \end{bmatrix}$을 계산
    - 벡터에 역행렬을 곱해 산출하고, 매개변수 곡선의 다항식을 구해 곡선상의 임의의 점을 계산
  
    $$
    \begin{aligned}
    \begin{bmatrix}
    p^0\\\vdots\\p^n
    \end{bmatrix}&=
    \begin{bmatrix}
    {t_0}^n&\cdots&{t_0}^0\\
    &\vdots&\\
    {t_n}^n&\cdots&{t_n}^0
    \end{bmatrix}
    \begin{bmatrix}
    c_n\\\vdots\\c_0
    \end{bmatrix}\\
    \begin{bmatrix}
    c_n\\\vdots\\c_0
    \end{bmatrix}&=
    \begin{bmatrix}
    {t_0}^n&\cdots&{t_0}^0\\
    &\vdots&\\
    {t_n}^n&\cdots&{t_n}^0
    \end{bmatrix}
    \begin{bmatrix}
    p^0\\\vdots\\p_n
    \end{bmatrix}
    \end{aligned}
    $$
  
- 곡선과 스플라인
  - 제어점을 늘리면 늘릴수록 복잡한 곡선을 그릴 수 있지만 다음과 같은 문제가 있음
      1. 다항식의 차수가 올라가므로 식이 복잡해짐
      2. 시작 쪽의 제어점 위치를 조정하면 마지막 제어점 구간의 곡선도 움직임
      (국소석 제어(local control)가 듣지 않는 상태)
      3. 매개변수에 연동한 다항식 값의 변동폭이 커짐
  - 스플라인(spline)
    - 다항식 차수를 억제하면서 복수의 곡선을 절점(knot)으로 서로 연결하여 하나의 긴 곡선으로 다루는 방식
  
      ![이미지1](https://imgur.com/qnmd4pH.png)
  
    - 구성 부분 각각의 곡선은 국소적 제어가 가능하여 다른 곡선에 영향을 주지 않음
    - 각 곡선의 다항식은 차수를 억제하여 비교적 단순해짐
    - 절점 부분에서 두 개의 곡선이 급격한 각도로 연결되는 등 부자연스러운 상태가 될 수 있으므로 절점에서의 매끄로운 연결을 어떻게 할 것인지
  
  - 연속성(continuity)과 미분(differentiation)
    - 두 개의 선이 어떻게 연속하는 지는 연속성과 함수의 평활도(smoothness)로 정의
    - 매개변수 곡선의 연속성은 다음과 같은 순서로 표현
        1. $\mathbf{C}^0$ : 두 개의 곡선이 연결되어 있음
            : 앞 곡선의 종점과 다음 곡선의 시점이 일치
        2. $\mathbf{C}^1$ : 두 개의 곡선이 연결된 점에서의 기울기가 같음
            : 두 개의 곡선의 다항식에 미분하여 얻은 도함수(derivative)가 같음
        3. $\mathbf{C}^2$ : 두 개의 곡선이 연결된 점에서의 기울기와 곡률(curvature)이 모두 같음
            : 두 개의 곡선의 다항식을 2회 미분하여 얻은 2계 도함수가 같음
  
    - 미분
      - 함수 $f(x)$에서 $x$가 아주 작은 값인 $\Delta{x}$만큼 변했을 때 $f(x)$의 기울기 $f^\prime(x)$
  
        $$
        f^\prime(x)=\lim_{\Delta{x} \rArr 0}\dfrac{f(x+\Delta{x})-f(x)}{\Delta{x}}=\dfrac{dy}{dx}
        $$
  
        1. $\lim_{\Delta{x} \rArr 0}$ : 극한(limit)를 나타내며 $\Delta{x}$가 한없이 0에 가까워짐($dx$)
        2. $f^\prime(x)$ : 도함수라 하고 도함수를 구하는 것을 미분이라 함

      - 함수를 $n$회 미분하는 것을 $n$계 미분이라 함
      - 2차 다항식으로 표현된 스플라인을 2차 스플라인(quadratic spline), 3차 다항식으로 표현된 스플라인을 3차 스플라인(cubic spline)이라 함
  
  - 이원수를 이용한 자동미분
    - 기호적 미분(symbolic differentiation)
      - 일반적으로 컴퓨터를 이용해 미분하는 방법
      - 미분 대상 식을 트리 구조로 분해 후, 끝에서부터 미분
      - 메모리를 많이 점유하는 단점이 있음
    - 수치미분(numerical differentiation)
      - 기호적 미분을 할 수 없을 때 어느 정도 오차를 허용하여 근사적으로 미분하는 것
      - 오차에 따른 부정확성을 허용해야하는 단점이 있음
    - 자동미분(automatic differentiation)
      - 정의된 함수를 정확히 미분하기 위한 알고리즘
      - 방식의 하나로 테일러 급수(Taylor series)와 이원수를 이용
  
        $$
        \begin{aligned}
        f(x)&=\sum_{n=0}^\infin\dfrac{f^{(n)}(a)}{n!}(x-a)^n\\
        f(x+h)_{\vert{x=x}}&=\sum_{n=0}^\infin\dfrac{f^{(n)}(x)}{n!}(x+h-x)^n\\
        &=\sum_{n=0}^\infin\dfrac{f^{(n)}(x)}{n!}h^n\\
        &=f^\prime(x)+\dfrac{f^\prime(x)}{1!}h+\dfrac{f^{\prime\prime}(x)}{2!}h^2+\cdots
        \end{aligned}
        $$
  
      - $x+h$ 대신 이원수 $x+\varepsilon$를 적용할 때 $\varepsilon^n=0$이므로 다음과 같음
  
          $$
          \begin{aligned}
          f(x+\varepsilon)&=f(x)+\dfrac{f^\prime(x)}{1!}\varepsilon+\dfrac{f^{\prime\prime}(x)}{2!}\varepsilon^2+\cdots\\
          &=f(x)+\dfrac{f^\prime(x)}{1!}\varepsilon\\
          &=f(x)+f^\prime(x)\varepsilon
          \end{aligned}
          $$
  
        따라서, $f(x+\varepsilon)$을 계산하여 얻은 이원수의 실수부는 이전 $f(x)$  값을, 이원수부가 미분값을 나타냄
  
      - 이원수를 이용하여 구현 시 함수의 `float`과 같은 기본형(Primitive Type)을 모두 이원수 클래스로 바꾸고, 연산자 오버로딩으로 기본 연산을 적용할 수 있게 해야함
  
## 2. 곡선 알고리즘

---

1. 베지어 곡선(Bezier curve)
    - 1차 베지어 곡선
      ![이미지2](https://imgur.com/ZV006LQ.png)

      $$
      p(t)=(1-t)a+tb
      $$

      - 시간 $t$가 증가함에 따라 $a$의 가중치$(1-t)$는 감소하고 $b$의 가중치 $(t)$가 증가함
      - 두 개의 제어점의 가중평균(weighted average)으로서의 선형보간
    - 2차 베지어 곡선
      ![이미지3](https://imgur.com/kQEToNM.png)

      $$
      \begin{aligned}
      e(t)&=(1-t)a+tb\\
      f(t)&=(1-t)b+tc
      \end{aligned}
      $$

      $$
      p(t)=(1-t)e(t)+tf(t)
      $$

      - $e(t)$와 $f(t)$는 각각 $e$와 $f$의 위치를 $t$라는 매개변수로 변화시키는 매개변수 함수로 $t$에 대해 1차 함수임
      - 포물선(parabola)을 선형 변환한 것이고 완성된 곡선은 시점과 종점 이외의 제어점은 지나지 않음
    - 드 카스텔조 알고리즘(De Casteljau’s algorithm)
        - 제어점이 늘어나도 곡선끼리 블렌딩해 가므로 제어점이 증가할 때마다 다항식 차수가 올라감
        - 최종적인 다항식을 재귀적으로 조립해가는 알고리즘
    - 아핀 불변성(Affine invariance)
        - 선형보간이 아핀 변환에 의해 비율을 바꾸지 않기 때문에 베지어 곡선을 아핀 변환할 경우 아핀 변환한 제어점을 사용해 베지어 곡선을 그릴 수 있음
        - 원근투영 변환은 불변성이 없음
    - 베지어 곡선의 다항식 $B(t)$ 의 일반형($t\in[0,1]$)

        $$
        B(t)=\sum_{i=0}^nb_{i,n}(t)P_i
        $$

      - $P_i$는 $(i+1)$번째 제어점
      - $b_{i,n}(t)$는 $n$차 번스타인 다항식(Bernstein polynomial)

        $$
        b_{i,n}(t)=\dfrac{n!}{i!(n-i)!}(t^i(1-t)^{n-1})
        $$

      - 일반적으로 $n+1$개의 제어점에 관해 일일히 풀 일은 없고, 2차 또는 3차 베지어 곡선으로 스플라인을 구성하고 2차/3차 다항식을 전개한 상태로 기술
      - $\mathbf{C}^0$의 연속성만 가지므로, 그 이상의 연속성을 부여하고 싶을 때는 알고리즘 쪽에서 제어점을 늘리는 등의 조치가 필요
    - 2차 베지어 스플라인의 다항식 $B(t)$의 행렬 표현$(t\in[0,1])$

      $$
      \begin{aligned}
      B(t)&=(1-t)^2P_0+2(1-t)tP_1+t^2P_2\\
      &=\mathbf{TCG}=\begin{bmatrix}
      t^2&t^1&1
      \end{bmatrix}\begin{bmatrix}
      1 & -2 & 1\\
      -2 & 2 & 0\\
      1 & 0 & 0
      \end{bmatrix}\begin{bmatrix}
      P_0\\P_1\\P_2
      \end{bmatrix}
      \end{aligned}
      $$

      - $\mathbf{T}$ : 매개변수 행렬
      - $\mathbf{C}$ : 다항식의 계수 행렬
      - $\mathbf{G}$ : 제어점이 들어간 지오메트리 행렬
  
2. 캣멀롬(Catmull-Rom) 스플라인
   - 모든 제어점을 통과해 보간하고 국소적으로 제어할 수 있어 $\mathbf{C}^1$ 연속성이 있음
   - 곡선 알고리즘으로서는 3차 에르미트 곡선(Cubic Hermite curve)을 사용
      ![이미지3](https://imgur.com/W9Ry2FE.png)

      - 시점 $\mathbf{P}_0$, 종점 $\mathbf{P}_1$이라는 2개의 제어점 외에, $\mathbf{P}_0$에서의 접선 $\mathbf{P^\prime}_0$과 $\mathbf{P}_1$에서의 접선 $\mathbf{P^\prime}_1$이라는 4개의 벡터를 사용
   - 3차 에르미트 곡선 다항식 $H(t)$  
      $H(t)$는 3차 매개변수 곡선이므로 3차 다항식임

        $$
        H(t)=c_0+c_1t+c_2t^2+c_3t^3
        $$

      $t\in[0,1]$이므로 시점 $$ $\cdot$ 종점과 접선들의 조건을 적용하면 $t=0$일때와 $t=1$일때

        $$
        \begin{aligned}
        H(0)&=c_0\\
        H(1)&=c_0+c_1+c_2+c_3
        \end{aligned}
        $$

      $H(t)$의 미분한 도함수 $H^\prime(t)$는 다음과 같음

        $$
        H^\prime(t)=c_1+2c_2t+3c_3t^2
        $$

      도함수가 $t=0$일때와 $t=1$때

        $$
        \begin{aligned}
        H^\prime(0)&=c_1\\
        H^\prime(1)&=c_1+2c_2+3c_3
        \end{aligned}
        $$

      위 방정식을 연립하면 다음과 같음

        $$
        \begin{aligned}
        H(t)=(1-3t^2+2t^3)H(0)+(3t^2-2t^3)H(1)\\+(t-2t^2+t^3)H^\prime(0)+(-t^2+t^3)H^\prime(1)
        \end{aligned}
        $$

      다항식 $H(t)$를 행렬로 표현하면 다음과 같음

        $$
        H(t)=\mathbf{TCG}=\begin{bmatrix}
        1 & t^1 & t^2 & t^3
        \end{bmatrix}\begin{bmatrix}
        1 & 0 & 0 & 0\\
        0 & 0 & 1 & 0\\
        -3 & 3 & -2 & -1\\
        2 & -2 & 1 & 1
        \end{bmatrix}\begin{bmatrix}
        H(0)\\H(1)\\H^\prime(0)\\H^\prime(1)
        \end{bmatrix}
        $$

   - 3차 에르미트 곡선을 사용해 $\mathbf{C}^1$ 연속성을 갖춘 캣멀롬 스플라인  
    스플라인 곡선 안의 곡선의 시점을 $\mathbf{P_i}$, 종점을 $\mathbf{P_{i+1}}$이라 할때 $\mathbf{P_i}$과 $\mathbf{P_{i+1}}$의 접선

      $$
      \dfrac{\mathbf{P}_{i+1}-\mathbf{P}_{i-1}}{2}
      $$

      $$
      \dfrac{\mathbf{P}_{i+2}-\mathbf{P}_i}{2}
      $$  

      이상 캣멀롬 스플라인을 나타내는 행렬 $\mathbf{Q}(t)$는 다음과 같음

      $$
      \mathbf{Q}(t)=\mathbf{TCG}=\begin{bmatrix}
      1 & t^1 & t^2 & t^3
      \end{bmatrix}\begin{bmatrix}
      1 & 0 & 0 & 0\\
      0 & 0 & 1 & 0\\
      -3 & 3 & -2 & -1\\
      2 & -2 & 1 & 1
      \end{bmatrix}\begin{bmatrix}
      \mathbf{P}_i\\\mathbf{P}_{i+1}\\\dfrac{\mathbf{P}_{i+1}-\mathbf{P}_{i-1}}{2}\\\dfrac{\mathbf{P}_{i+2}-\mathbf{P}_i}{2}
      \end{bmatrix}
      $$
  
3. B 스플라인(B-spline)
    - B는 기저(basis)의 줄임말로 베지어 곡선을 일반화한 알고리즘
    - $\mathbf{C}^2$ 연속성을 가지므로 절점끼리 매끄럽게 연결되며 국소적인 제어가 가능함
    - 보간이 아닌 근사로, 제어점은 지나지 않음
    - 블렌딩 함수(blending function)으로 번스타인 다항식 대신 B 스플라인 기저 함수(B-spline basis function)을 사용
    - $k-1$차 B 스플라인의 정의
      - 제어점의 수와 차수는 독립적이며, 제어점의 수는 오더 이상이라면 몇 개든 상관없음
      - 드 카스텔조 알고리즘의 일반화인 드 보어 알고리즘(De Boor’s Algorithm) 사용

        $$
        \begin{aligned}
        B(t)&=\sum_{i=0}^nN_{i,k}(t)\mathbf{P}_i\\
        N_{i,1}(t)&=\begin{cases}
        1 & (x_i\le{t}<x_{i+1})\\
        0 & (t<x_i,x_{i+1}<t)
        \end{cases}\\
        N_{i,k}(t)&=\dfrac{t-x_i}{x_{i+k-1}-x_i}N_{i,k-1}(t)+\dfrac{x_{i+k}-t}{x_{i+k}-x_{i+1}}N_{i+1,k-1}(t)
        \end{aligned}
        $$  

        - $\mathbf{P}_i$ : $(i+1)$번째 제어점$(i\in[0,n])$
        - $k$ : 차수보다 $1$ 많은 오더(order)
        - $x_i$ : $n+k+1$ 개의 절점$(i\in[0,n+k])$
      - 블렌딩 함수는 그림으로 나타내면 피라미드 모양
      - 오더 $k$의 블렌딩 함수를 만들기 위해서는 $k-1$의 블렌딩 함수를 조합
      - 차례로 낮은 오더의 블렌딩 함수를 재귀적으로 호출하여 구체적인 값으로서 오더 1의 $N_{i,1}(t)$ 값이 0이나 1로 돌아온 것을 모아 높은 오더로 반환해, 계수를 곱해 합성함
    - B 스플라인의 특징
        - 네 개의 점 $\mathbf{P_{i-2}},\mathbf{P_{i-1}},\mathbf{P_i},\mathbf{P_{i+1}}$을 선택하고 $\mathbf{P_{i-1}}$과 $\mathbf{P_i}$를 근사를 위해 계속 사용하면서, $\mathbf{P_{i-2}}, \mathbf{P_{i+1}}$은 접선을 구하기 위해 사용함
        - 최초의 제어점으로부터 하나씩 앞으로 나아가며 차례로 반복하여 계산
    - 3차 B 스플라인의 기저함수의 다항식 계산

        $$
        \begin{aligned}
        B(t)&=\sum_{i=0}^3N_{i,4}(t)\mathbf{P}_i\\
        &=\dfrac{(1-t)^3}{6}\mathbf{P}_0+\dfrac{3t_3-6t^2+4}{6}\mathbf{P}_1+\dfrac{-3t^3+3t^2+3t+1}{6}\mathbf{P}_2+\dfrac{t^3}{6}\mathbf{P}_3\\
        &=\mathbf{TCG}=\begin{bmatrix}
        t^3 & t^2 & t & 1
        \end{bmatrix}\dfrac{1}{6}\begin{bmatrix}
        -1 & 3 & -3 & 1\\
        3 & -6 & 3 & 0\\
        -3 & 0 & 3 & 0\\
        1 & 4 & 1 & 0
        \end{bmatrix}\begin{bmatrix}
        \mathbf{P}_i\\\mathbf{P}_{i+1}\\\mathbf{P}_{i+2}\\\mathbf{P}_{i+3}
        \end{bmatrix}
        \end{aligned}
        $$

     1. 균일 B 스플라인(uniform B-spline)
         - 위의 B 스플라인과 같이 절점 간격이 일정한 것
     2. 비균일 B 스플라인(non-uniform B-spline)
         - 절점 간격이 일정하지 않음
         - 제어점에 가중치를 부여하면(동차 좌표로 표현하고 $w$ 성분에 가중치가 저장) 유리(rational)하다고 함
