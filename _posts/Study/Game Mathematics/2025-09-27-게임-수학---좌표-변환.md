---
title: 게임 수학 - 좌표 변환
date: 2025-09-27
categories: [Study, Game Mathematics]
tags: [Game Engineering, Game Mathematics, Unity, Unreal,  게임공학, 게임수학, 유니티, 언리얼, 좌표변환]
pin: false
math: true
image:
  path: https://imgur.com/lUpsAQ9.jpg
---

## 1. 좌표 변환이란

---

- 서로 다른 좌표계 사이에서 좌표를 변환하는 작업의 총칭
- 여기서는 ‘행렬 = 변환’이라고 봄
- 3D 공간 내에 대량의 정점 정보에 대해 동시 병렬로 좌표 변환을 적용하기 위해 GPU가 도입
- 이때 폴리곤의 형상을 나타내는 정점 데이터를 지오메트리(geometry)라고 함

## 2. 지오메트리 파이프라인

---

1. 모델 변환(model trasnform)
    - 3D 모델의 폴리곤 메시가 가진 모델 공간의 로컬 좌표계상 좌표로부터 월드 좌표계상의 좌표로 변환하는 것
    - 월드 좌표계로 변환하므로 월드 변환(world transform)이라고도 함
    - 평행이동(translate), 회전(rotation), 스케일(scale)의 세 가지 요소로 변위를 좌표에 적용함
2. 뷰 변환
    - 월드 공간 좌표에서 카메라를 중심으로 한 카메라 공간(camera space) 좌표로 변환
    - 카메라 공간을 가리켜 뷰 공간(view space)이라고도 함
3. 프로젝션 변환
    - 뷰 좌표계에서 일부 불필요한 부분을 제거한 클립 공간(clip space)로 변환
    - 이때 불필요한 부분은 카메라에서 보이지 않는 영역인 뷰 프러스텀(시야 절두체, view frustum)이라고 하고 이때 뷰 프러스텀은 시야를 나타냄
    - 시야 바깥쪽의 정점 정보를 버리고, 뷰 프러스텀을 정규 뷰 볼륨(canonical view volume)이라 하는 각 정점 좌표가 정규화된 정육면체로 변환하는 것
    - 뷰 프러스텀 중 카메라에 가까운 평면을 근평면(near clipping plane), 먼 쪽을 원평면(far clipping plane)이라고 함
    - 시야각(Field Of View, **FOV**)이 크면 클 수록 근평면과 원평면의 크기 비율 측면에서 원평면이 더 커짐
    - 프로젝션 변환에서 원평면에 가까워질 수록(먼 거리의 물체) 오브젝트의 응축도가 높아지고 근평면에 가까울 수록(가까운 물체) 오브젝트가 커지므로 일반적인 3D 원근법 효과가 시뮬레이트되고 이런 프로젝션 변환 방법을 원근투영(perspective projection)이라 함

## 3. 동차좌표계

---

- 동차좌표계란
  - 정규 뷰 볼륨에 대해 뷰포트 변환(viewport transform)이 이루어지고 2D의 윈도우 좌표계(window coordinate system) 또는 스크린 좌표계로 변환함
  - 이때 단순히 z값을 빼고 x, y 값만 남긴 후 스크린 크기에 맞게 스케일 변환을 하는데 떨어져 나간 z값은 Z 버퍼(Z-buffer, depth buffer)에 저장되어 심도 테스트(depth test)에 쓰임
  - 정규 뷰 볼륨이 생기기 전 정규화 디바이스 좌표계(Normalized Device Coordinate, **NDC**)로 변환하는 원근분할(perspective division)이 있음
  - 원근분할은 $x$, $y$, $z$, $w$를 $w$로 나누어 $w$ 성분은 정규 뷰 볼륨에서 원근법의 시뮬레이션을 위한 계수로 작용함
  - 클립 좌표계는 ($x$, $y$, $z$, $w$)라는 4차원으로 표현되는 좌표계이고 동차좌표계(homogeneous coordinate)라 함
  - 클립 좌표계를 원근분할하여, $w$ 성분이 1이 되어 무시할 수 있게 되면 3차원 좌표로서 정규 디바이스 좌표계를 얻을 수 있음
  
- 동차좌표계와 사영기하학
  - 동차좌표계는 사영기하학(projective geometry)에 사용되는 좌표계로 유클리드 기하학과 달리 평행선은 무한원점(point at infinity)에서 교차한다고 생각함
  - 동차좌표계에서는 각 성분끼리의 비율만 의미가 있으며 $n$이 $0$이 아닌 정수일 때 $(x, y, z, w)$와 $(nx, ny, nz, nw)는 동차좌표로서 같음
  - 동차좌표로부터 대응하는 직교좌표를 산출하려면 $w$로 다른 성분을 나누어주면 됨
  - 나누기를 하지 않는 이상 ($x$, $y$, $z$, 0)으로 직교좌표로는 표현할 수 없는 무한원점을 동차좌표로 표현할 수 있고 이때 무한원점은 직사광(`directional light`)로서 이용되는데 $w$ 성분이 0인지 아닌지 조사하면 직사광인지 점광원(`point light`)인지 알 수 있음

## 4. 변환 종류

---

- 선형 변환(linear transformation)
  - 변환 $f$가 선형 변환이라면, 임의의 벡터 $\mathbf{u}$, $\mathbf{v}$와 스칼라 n에 관해 다음을 만족
  
    $$
    \begin{aligned}
    f(\mathbf{u}+\mathbf{v})&=f(\mathbf{u})+f(\mathbf{v})\\
    f(n\mathbf{v})&=nf(\mathbf{v})\\
    f(0)&=f(0+0)=f(0)+f(0)
    \end{aligned}
    $$
  
    1. 직선은 변환해도 직선
    2. 복수 정점 간의 상대적인 거리의 비율은 변화하지 않음
    3. 서로 평행인 직선은 변환해도 직선
    4. 영벡터는 변환해도 영벡터
    5. 선형 변환의 행렬 $\mathbf{M}$은 가역행렬로, 서로의 곱은 단위행렬 $\mathbf{I}$가 됨
    6. 회전, 스케일은 선형변환이지만 영벡터를 평행이동하면 영벡터가 아니게 되므로 평행이동은 선형변환이 아님
  
- 아핀 변환(affine transformation)
  - 선형 변환만으로는 평행 이동을 표현할 수 없어 도입된 개념
  - 아핀 변환 $a$는 선형 변환 $f$와 벡터 $\mathbf{u}$, $\mathbf{v}$를 다음과 같이 표현
  
    $$
    a(\mathbf{v})=f(\mathbf{v})+\mathbf{u}
    $$
  
  - 벡터 $\mathbf{u}$가 있으므로 영벡터의 평행이동 결과가 반드시 영벡터여야만 할 필연성이 없음
  - 그 밖의 선형 변환의 특징은 모두 아핀 변환에 합성되어 포함됨
  - 잘 사용되지는 않지만 직사각형을 평행사변형으로 하는 전단(shear)도 여기 속함
  
- 리지드바디 변환(rigidbody transformation)
  - 아핀 변환에서 스케일울 제외한 변환
  - 유클리드 변환(Euclidean transformation), 등거리 변환(isometry transformation)이라고도 함
  - 변환 이후 두 개 점의 거리가 변하지 않음
  
- 투영 변환(projective transformation, homography)
  - 원근투영 변환 등 아핀 공간을 포함하는, 더 넓은 공간인 투영 공간 내의 변환
  - 동일 선상의 내 개의 점 A, B, C, D 간의 선분으로, 다음과 같이 표현되는 복비(unhamonic ratio) 또는 교차비(cross ratio)라는 비율이 변환 후에도 변화하지 않는 변환
  
    $$
    \dfrac{\mathbf{AC}\cdot\mathbf{BD}}{\mathbf{BC}\cdot\mathbf{AD}}
    $$

## 5. 좌표 변환의 행렬 표현

---

- 평행이동
  - 4차원 동차 좌표 벡터 $\mathbf{v}$에 대해, 행렬 $\mathbf{T}$와의 곱셈으로 표현
  
    $$
    \mathbf{T}\mathbf{v}=\begin{bmatrix}
    1 & 0 & 0 & t_x\\
    0 & 1 & 0 & t_y\\
    0 & 0 & 1 & t_z\\
    0 & 0 & 0 & 1
    \end{bmatrix}
    \begin{bmatrix}
    v_x\\
    v_y\\
    v_z\\
    1
    \end{bmatrix}
    $$
  
- 회전
  - 어느 축으로 회전할 것인지, 회전 각도는 어느 정도 인지로 규정되는 변환
  - 4차원 동차 좌표 벡터 $\mathbf{v}$에 대해, 행렬 $\mathbf{R}$와의 곱셈으로 표현
  
    $$
    \mathbf{R}_x=\begin{bmatrix}
    1 & 0 & 0 & 0\\
    0 & \cos\theta & -\sin\theta & 0\\
    0 & \sin\theta & \cos\theta & 0\\
    0 & 0 & 0 & 1
    \end{bmatrix}\\
    \mathbf{R}_y=\begin{bmatrix}
    \cos\theta & 0 & \sin\theta & 0\\
    0 & 1 & 0 & 0\\
    -\sin\theta & 0 & \cos\theta & 0\\
    0 & 0 & 0 & 1
    \end{bmatrix}\\
    \mathbf{R}_z=\begin{bmatrix}
    \cos\theta & -\sin\theta & 0 & 0\\
    \sin\theta & \cos\theta & 0 & 0\\
    0 & 0 & 1 & 0\\
    0 & 0 & 0 & 1
    \end{bmatrix}
    $$
  
  - 행렬 $\mathbf{R}$은 특수직교행렬이고 $\lvert\mathbf{R}\rvert=1$도 성립
  - 직교행렬이므로 전치하면 회전된 상태에서 원래 상태로 돌아오는 변환의 행렬
  
- 스케일
  - 행렬 $\mathbf{S}$는 단순히 벡터 $\mathbf{v}$의 각 성분에 배율을 곱하여 구함
  
    $$
    \mathbf{S}=\begin{bmatrix}
    S_x & 0 & 0 & 0\\
    0 & S_y & 0 & 0\\
    0 & 0 & S_z & 0\\
    0 & 0 & 0 & 1
    \end{bmatrix}
    $$
  
  - 스케일 변환의 행렬식은 체적이 몇 배 팽창하는지의 배율
  - 행렬식이 0이라면 3차원 입체에서 2차원 평면도로 변환하는 특정 투영 변환이 포함되고 이러한 변환 행렬은 계수(rank)가 2 이하가 됨
  - 행렬식이 -1이라면 반사 변환(Reflection)으로 왼손 좌표계와 오른손 좌표계 서로의 좌표계로 바꾸는, $z$축을 반대로 함
  
- 모델 변환
  - 로컬 좌표계 상의 위치 벡터 $\mathbf{v}$에 대해 스케일 $\mathbf{S}$, 회전 $\mathbf{R}$, 평행 이동 $\mathbf{T}$의 각 좌표 변환을 적용해 월드 좌표계의 위치 벡터 $\mathbf{v}^\prime$
  
    $$
    \begin{aligned}
    \mathbf{v}^\prime&=\mathbf{T}(\mathbf{R}(\mathbf{Sv}))\\
    \;\;&=(\mathbf{TRS})\mathbf{v}
    \end{aligned}
    $$
  
  - 따라서 차례로 변환을 적용할 필요 없이 미리 $\mathbf{TRS}$를 계산한 모델 변환 행렬 $\mathbf{M}=\mathbf{TRS}$로 대량의 정점 정보를 똑같이 모델 변환에 적용할 수 있음
  - 지오메트리 파이프라인 상의 각 스테이지를 구성하는 좌표변환에서 모델 변환 행렬 $\mathbf{M}$, 뷰 변환 행렬 $\mathbf{V}$, 프로젝션 변환 행렬 $\mathbf{P}$가 있을 때
  
    $$
    \begin{aligned}
    \mathbf{v}^\prime&=\mathbf{P}(\mathbf{V}(\mathbf{Mv}))\\
    &=(\mathbf{PVM})\mathbf{v}
    \end{aligned}
    $$
  
  - 지오메트리 파이프라인 좌표 변환 행렬 $\mathbf{PVM}$은 ShaderLab의 내장 변수 UNITY_MATRIX_MVP로, 혹은 GLSL에서는 gl_ModelViewProjectionMatrix로 참조 함
  
- 기저 변환(change of basis)
  
    $$
    \mathbf{M}=\mathbf{TRS}=\begin{bmatrix}
    \mathbf{S}_x\mathbf{R}_{11} & \mathbf{S}_y\mathbf{R}_{12} & \mathbf{S}_z\mathbf{R}_{13} & t_x\\
    \mathbf{S}_x\mathbf{R}_{21} & \mathbf{S}_y\mathbf{R}_{22} & \mathbf{S}_z\mathbf{R}_{23} & t_y\\
    \mathbf{S}_x\mathbf{R}_{31} & \mathbf{S}_y\mathbf{R}_{32} & \mathbf{S}_z\mathbf{R}_{33} & t_z\\
    0 & 0 & 0 & 1
    \end{bmatrix}
    $$
  
  1. 평행이동 추출은 단순히 4열째의 위에서부터 세 개의 요소임
  2. 스케일 변환은 행렬 $\mathbf{M}$의 열 벡터의 크기를 계산하여 추출함
  3. 회전은 평행이동과 스케일이 구해지면 행렬 $\mathbf{M}$에서 제거하여 구함
  
  - 모델 변환 행렬이란 모델 좌표계와 월드 좌표계의 차이를 바로 잡는 것이며 결국 기저 변환을 하는 것
  - 기저 변환은 좌표의 변환이고 좌표계의 변환
  - 모델 변환 행렬에서 추출한 $3\times3$의 회전행렬의 1~3열은 다음과 같음
    - **모델 좌표계에서 보면** : 월드 좌표계의 기저벡터
    - **월드 좌표계에서 보면** : 모델 좌표계의 기저벡터

- 뷰 변환
  - 월드 좌표계의 좌표츅을 카메라의 좌표축으로 이동하는 것
  - 다음 2가지 좌표 변환이 필요
    - 월드 좌표계의 좌표축을 카메라가 있는 위치 $\mathbf{C}$로 평행이동
    - 이동한 좌표축을 카메라 방향에 맞게 회전
  - 카메라 위치 $\mathbf{C}$가 월드 좌표계에서 $(C_x,C_y,C_z)$에 있고 본래 월드 좌표계에서의 카메라의 위쪽을 나타내는 벡터 $\mathbf{U}$(예를 들면 `Vector3.up`)라 할때 평행이동 행렬 $\mathbf{T}$는 다음과 같음
  
    $$
    \mathbf{T}=\begin{bmatrix}
    1 & 0 & 0 & -C_x\\
    0 & 1 & 0 & -C_y\\
    0 & 0 & 1 & -C_z\\
    0 & 0 & 0 & 1
    \end{bmatrix}
    $$
  
  - 카메라 시선의 끝점이 $\mathbf{P}$일때 $\mathbf{P}$에서 $\mathbf{C}$로 향하는 벡터를 정규화하면 기저벡터 Z를 얻음
  - 기저벡터 $\mathbf{X}$는 $\mathbf{Z}$와 $\mathbf{U}$의, 기저벡터 $\mathbf{Y}$는 $\mathbf{X}$와 $\mathbf{Z}$의 외적을 정규화
  
    $$
    \mathbf{Z}=\dfrac{\mathbf{C-P}}{\lvert\mathbf{C-P}\rvert}\\
    \mathbf{X}=\dfrac{\mathbf{U\times Z}}{\lvert\mathbf{U\times Z}\rvert}\\
    \mathbf{Y}=\dfrac{\mathbf{Z\times X}}{\lvert\mathbf{Z\times X}\rvert}
    $$
  
  - 월드 좌표계의 단위벡터에서 기저벡터로 변환하는 행렬의 전치행렬이 카메라 방향으로의 회전을 나타내는 행렬 $\mathbf{R}$
  
    $$
    \mathbf{R}=\begin{bmatrix}
    X_x & X_y & X_z & 0\\
    Y_x & Y_y & Y_z & 0\\
    Z_x & Z_y & Z_z & 0\\
    0 & 0 & 0 & 1\\
    \end{bmatrix}
    $$
  
  - 따라서 뷰 변환 행렬 $\mathbf{V}$는 다음과 같음
  
    $$
    \mathbf{V}=\mathbf{RT}
    =\begin{bmatrix}
    X_x & X_y & X_z & 0\\
    Y_x & Y_y & Y_z & 0\\
    Z_x & Z_y & Z_z & 0\\
    0 & 0 & 0 & 1\\
    \end{bmatrix}\begin{bmatrix}
    1 & 0 & 0 & -C_x\\
    0 & 1 & 0 & -C_y\\
    0 & 0 & 1 & -C_z\\
    0 & 0 & 0 & 1
    \end{bmatrix}
    $$
  
    $\mathbf{V}$의 4열 각 요소는 $\mathbf{R}$의 각 행벡터인  $\mathbf{X}$, $\mathbf{Y}$, $\mathbf{Z}$와 $\mathbf{T}$의 열벡터 $-\mathbf{C}$와의 내적이므로
  
    $$
    \mathbf{V}=\begin{bmatrix}
    X_x & X_y & X_z & -\mathbf{C}\cdot\mathbf{X}\\
    Y_x & Y_y & Y_z & -\mathbf{C}\cdot\mathbf{Y}\\
    Z_x & Z_y & Z_z & -\mathbf{C}\cdot\mathbf{Z}\\
    0 & 0 & 0 & 1\\
    \end{bmatrix}
    $$
  
- 원근투영 변환

    > - 유도 과정1  
    > 원점으로부터 근평면까지의 거리를 $n$, 원평면까지의 거리를 $f$라고 할 때 $z$축이 뷰 프로스텀과 반대쪽으로 뻗어가므로 근평면과 원평면의 $z$ 값은 각각 $-n$, $-f$임
    > 먼저, 뷰 좌표계의 정점 $\mathbf{D}(D_x,D_y,D_z)$일 때 $xz$ 평면에서 원점과 $\mathbf{D}$를 잇는 직선과 근평면의 교점 $\mathbf{N}$의 $x$좌표 $N_x$, $y$좌표 $N_y$를 구함
    > $$
    > y = ax+b
    > $$  
    > 원점을 지나는 직선이므로 $b=0$, $\mathbf{D}$에서 $a=\dfrac{D_x}{D_y}$이므로 $x=-n$일때 다음과 같음  
    > $$
    > N_x=-n\dfrac{D_x}{D_z}=\dfrac{nD_x}{-D_z}
    > $$
    > 마찬가지로 $yz$ 평면에서는 다음과 같음  
    > $$
    > N_y=\dfrac{nD_y}{-D_z}
    > $$
    > 이때 두 요소 다 $-D_z$로 나누어져 있고 프로젝션 변환의 결과인 클립 좌표계의 $w$ 성분은 $-D_z$로, $D_z$에 의존해 변화함  
    > 따라서 프로젝션 변환 행렬 $\mathbf{P}$는 다음처럼 구성되어야 함
  
  - 프로젝션 변환 행렬 $\mathbf{P}$의 4행 3열이 -1이므로 P에 정점 벡터 $\mathbf{D}(D_x,D_y,D_z,D_w)$를 곱하면 $-D_z$만 남아 결과벡터의 $w$성분이 됨
  
    $$
    \mathbf{P}=\begin{bmatrix}
    m_{11} & m_{12} & m_{13} & m_{14}\\
    m_{21} & m_{22} & m_{23} & m_{24}\\
    m_{31} & m_{32} & m_{33} & m_{34}\\
    0 & 0 & -1 & 0\\
    \end{bmatrix}
    $$
  
  - 프로젝션 변환 후 범위가 [$l$, $r$]의 범위에서 [-1, 1]인 정규화 디바이스 좌표 범위 안에 사상되도록 함

    > - 유도 과정2
    > $l$로부터 $r$로의 변화가 -1부터 1로의 변화에 해당하므로 $ax+b$에서
    > $$
    > a=\dfrac{1-(-1)}{r-l}
    > $$
    > 원근분할 후 정규화 디바이스 좌표를 ($x_n$,$y_n$,$z_n$)이라 할 때
    > $$
    > x_n=aN_x+b\\
    > \qquad\qquad\quad=\dfrac{1-(-1)}{r-l}N_x+b
    > $$
    > $N_x=r$일 때 $x_n=1$이 되므로 $b=\dfrac{-r-l}{r-l}$이고 전체 식은
    > $$
    > x_n=\dfrac{1-(-1)}{r-l}N_x-\dfrac{r+l}{r-l}
    > $$
    > 최초의 식 $N_x=\dfrac{nD_x}{-D_z}$, $N_y=\dfrac{nD_y}{-D_z}$에 대입하면
    > $$
    > x_n=\dfrac{1}{-D_z}(\dfrac{2r}{r-l}D_x+\dfrac{r+l}{r-l}D_z)\\
    > y_n=\dfrac{1}{-D_z}(\dfrac{2n}{t-b}D_y+\dfrac{t+b}{t-b}D_z)
    > $$
    > $D_z$가 커질 수록 $z_n$은 작아지는 반비례 관계이므로
    > $$
    > z_n=\dfrac{a}{D_z}+b
    > $$
    > $D_z$가 $[-n, -f]$인 범위에서  $[-1, 1]$인 범위로 사상하므로, $D_z=-n$, $z_n=-1$과 $D_z=-f$, $z_n=1$을 각각 대입하면
    > $$
    > z_n=\dfrac{1}{-D_z}(\dfrac{-(f+n)}{f-n}D_z+\dfrac{-2fn}{f-n})
    > $$
    > 따라서 프로젝션 변환 행렬 $\mathbf{P}$는 다음을 만족함
    > $$
    > \begin{aligned}
    > \begin{bmatrix}
    > -D_zx_n\\
    > -D_zy_n\\
    > -D_zz_n\\
    > -D_z
    > \end{bmatrix}&=\mathbf{P}
    > \begin{bmatrix}
    > D_x\\D_y\\D_z\\1
    > \end{bmatrix}\\
    > \begin{bmatrix}
    > \dfrac{2n}{r-l}D_x+\dfrac{r+l}{r-l}D_z\\
    > \dfrac{2n}{t-b}D_y+\dfrac{t+b}{t-b}D_z\\
    > \dfrac{-(f+n)}{f-n}D_z+\dfrac{-2fn}{f-n}\\
    > -D_z
    > \end{bmatrix}&=\mathbf{P}
    > \begin{bmatrix}
    > D_x\\D_y\\D_z\\1
    > \end{bmatrix}\\
    > \end{aligned}
    > $$
  
  - 결국, 원근투영 변환의 프로젝션 변환 행렬 $\mathbf{P}$는 다음과 같음
  
    $$
    \mathbf{P}=\begin{bmatrix}
    \dfrac{2n}{r-l} & 0 & \dfrac{r+l}{r-l} & 0\\
    0 & \dfrac{2n}{t-b} & \dfrac{t+b}{t-b} & 0\\
    0 & 0 & \dfrac{-(f+n)}{f-n} & \dfrac{-2fn}{f-n}\\
    0 & 0 & -1 & 0\\
    \end{bmatrix}
    $$
  
  - OpenGL은 $z$축 범위 $[-1, 1]$을 사용하고 DirectX 에서는 $z$축 범위가 $[0, 1]$임
  
- 직교투영 변환
  - Camera 컴포넌트에서 Projection을 Orthographic으로 설정해야 사용할 수 있음
  - 화면 깊이에 따라 오브젝트가 보이는 방식이 바뀌지 않는 다는 점이 원근투영 변환과 다름
  - 변환 결과는 똑같은 정규 뷰 볼륨이지만, 변환 전 공간은 뷰 프러스텀이 아닌 단순한 직육면체
  
    > - 유도 과정
    > 근평면상에서 $P$의 $x$ 좌표가 [$l$, $r$] 범위, $y$ 좌표가 $[b, t]$ 범위였던 것을 $[-1, 1]$로 사상하는 원근투영 변환을 뷰 좌표 내의 점 $\mathbf{D}$에도 똑같이 적용할 수 있음
    > $$
    > x_n=\dfrac{2}{r-l}D_x-\dfrac{r+l}{r-l}\\
    > y_n=\dfrac{2}{t-b}D_y-\dfrac{t+b}{t-b}
    > $$
    > 오른손 좌표계인 뷰 좌표계에서 왼손 좌표계인 클립 좌표계가 되고, $[-n, -f]$에서 $[1, -1]$로 사상하므로 $z$는 $D_z$의 계수의 부호가 반전됨  
    > $$
    > z_n=\dfrac{-2}{f-n}D_z-\dfrac{f+n}{f-n}
    > $$  
    > 직교투영 변환의 프로젝션 변환 행렬 $\mathbf{P}$는 다음을 만족하는 행렬
    > $$
    > \begin{bmatrix}
    > x_n\\
    > y_n\\
    > z_n\\
    > 1
    > \end{bmatrix}=\mathbf{P}
    > \begin{bmatrix}
    > D_x\\D_y\\D_z\\1
    > \end{bmatrix}\\
    > \begin{bmatrix}
    > \dfrac{2}{r-l}D_x-\dfrac{r+l}{r-l}\\
    > \dfrac{2}{t-b}D_y-\dfrac{t+b}{t-b}\\
    > \dfrac{-2}{f-n}D_z+\dfrac{f+n}{f-n}\\
    > 1
    > \end{bmatrix}=\mathbf{P}
    > \begin{bmatrix}
    > D_x\\D_y\\D_z\\1
    > \end{bmatrix}\\
    > $$
  
  - 결국, 직교투영 변환의 프로젝션 변환 $\mathbf{P}$는 다음과 같음(DirectX의 경우는 조정이 필요)
  
    $$
    \mathbf{P}=\begin{bmatrix}
    \dfrac{2}{r-l} & 0 & 0 & -\dfrac{r+l}{r-l}\\
    0 & \dfrac{2}{t-b} & 0 & -\dfrac{t+b}{t-b}\\
    0 & 0 & \dfrac{-2}{f-n} & -\dfrac{f+n}{f-n}\\
    0 & 0 & 0 & 1\\
    \end{bmatrix}
    $$

- 등각투영 변환(isometric projection)
  - 시뮬레이션 게임 등 필드를 조감하는 형태의 게임에 주로 이용
  - 위 2가지 변환과 마찬가지로 평행 투영(parallel projection)의 일종이지만, 좌표 축끼리의 각도가 모두 120˚라는 특징이 있음
  - 1980년대 초부터 그래픽스 처리를 2D로 하면서도 3D와 유사해 보이게 하는 표현 기법으로 사용
  - 구현하고자 하는 표현에 따라서 오히려 구현이 복잡해지고 비용이 많이 들 수 있음
    - 2D에서 등각 투영 스타일로 표현하면 높이가 있거나 뒤섞인 구조물의 심도를 부분 별로 세분하여 정렬 해야함
    - 캐릭터 애니메이션용 스프라이트 이미지를 메모리 상에 잔뜩 올려두어야 함
    - 조명, 물리 연산의 영향 등 복잡한 처리를 넓은 범위에 적용할 때 특수하게 대응해야 함
  - 3D 등각투영을 실현하기 위해 필요한 조건
      1. 프로젝션 변환에서는 직교투영 변환을 사용
        → `Camera` 컴포넌트에서 `Projection`을 `Orthographic`으로 설정
  
      2. 비스듬히 위에서 본 시점이 되도록 뷰의 좌표계를 회전
        → 카메라의 `Transform`의 `Rotation`의 회전 각도 조정

    > - 유도 과정
    > 1. 좌표계의 기저벡터가 각 변이 되고, 각 변의 길이가 1, 정점 중 하나가 원점에 있는 정육면체를 카메라로 비춤
    > 2. 우선 카메라를 $y$ 축으로 45˚ 회전
    > 3. 바닥면과 대각선이 좌표축과 45˚를 이루므로, 정육면체의 세로 변 중 하나가 바로 정면에 오려면 대각선을 연장한 선의 반대 방향이 카메라의 방향
    > 4. 카메라의 정면의 변 위쪽의 정점이 정면으로 와야하므로 카메라를 띄워올려 비스듬히 비추도록 해야함
    > 5. 이때 각도 $\theta$는 정육면체의 밑변의 대각선 길이가 $\sqrt{2}$이므로, 밑변이 $\sqrt{2}$, 높이가 1인 직각삼각형으로 간주
    > $$
    > \tan\theta=\dfrac{1}{\sqrt{2}}
    > $$
  
    따라서 $x$ 축의 회전 각도 $\theta$는 다음과 같음

    $$
    \theta=\arctan(\dfrac{1}{\sqrt{2}})
    $$

    → $x$ 축으로 35˚, $y$ 축으로 45˚로 설정하면 대체로 문제 없는 등각투영 카메라가 됨
  
  - 2D에서 등각투영 스타일을 표현할 경우, 마름모꼴 타일 이미지를 빈틈없이 채운 맵을 사용하는게 일반적임
    - 타일 집합으로서 2D 맵을 만든 경우, 마름모꼴 타일이 나열된 스크린상의 좌표와 메모리상의 내부 표현 그리드의 칸으로서 좌표 대응 문제를 해결해야함
    - 내부 표현인 그리드에 대응되는 직교좌표에서 마름모꼴 타일 상태에 대응되는 사교좌표계의 대응관계
      1. 변환하려면 두가지가 필요
          - $z$ 축으로 45˚ 회전 $\mathbf{R}$
          - $y$ 축으로 $\dfrac{1}{2}$ 스케일 $\mathbf{S}$
      2. 직교좌표계의 위치 벡터 $\mathbf{v}$일때 등각투영된 타일 상 벡터 $\mathbf{u}$는 다음과 같음

      $$
      \mathbf{u}=(\mathbf{S}\mathbf{R})\mathbf{v}
      $$
  
      3. 클릭한 위치가 어느 타일인지 판정하는 것은 $\mathbf{u}$에서 $\mathbf{v}$를 구하는 것과 같음
  
      $$
      \mathbf{v}=(\mathbf{P}^{-1}\mathbf{S}^{-1})\mathbf{u}
      $$

      회전 변환의 삼각 함수 호출 없이 간단하게 나타내는 방법

      - $\mathbf{v}=(v_x,v_y)$, $\mathbf{u}=(u_x,u_y)$, 타일 폭의 절반을 $w$, 타일의 높이 절반을 $h$라 할때, $\mathbf{u}$는 기울기가 $\dfrac{h}{w}$인 1차 함수상에 있음
  
        $$
        u_x=(v_x-v_y)*w\\
        u_y=(v_x+v_y)*h
        $$
  
      - 따라서 $\mathbf{v}$는 다음과 같음

        $$
        \begin{aligned}
        v_x&=\dfrac{1}{2}(\dfrac{u_x}{w}+\dfrac{u_y}{h})\\
        v_y&=\dfrac{1}{2}(-\dfrac{u_x}{w}+\dfrac{u_y}{h})
        \end{aligned}
        $$
