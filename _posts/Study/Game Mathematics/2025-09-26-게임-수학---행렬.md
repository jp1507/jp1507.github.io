---
title: 게임 수학 - 행렬
date: 2025-09-26
categories: [Study, Game Mathematics]
tags: [Game Engineering, Game Mathematics, Unity, Unreal, matrix, 게임공학, 게임수학, 유니티, 언리얼, 행렬]
pin: false
math: true
image:
  path: https://imgur.com/lUpsAQ9.jpg
---

## 1. 행렬의 정의

---

- 행렬(matrix)은 행(row)과 열(column)이 있는 격자모양 배열 안에 요소(element)를 나열한 것
- 행렬의 종류
  - 정사각행렬(square matrix) : 행과 열의 수가 같은 행렬
  - 대각행렬(diagonal matrix) : 정사각행렬이고 대각 요소 이외의 요소가 모두 0인 행렬
  - 단위행렬(identity maxtrix) : 대각행렬 중 대각요소가 모두 1인 행렬
  - 영행렬(zero matrix, null maxtrix) : 모든 요소가 0인 행렬

## 2. 행렬의 연산

---

- 행렬끼리의 연산
  - 행렬끼리의 덧셈과 스칼라배 곱셈이 가능
  - $m \times n$ 행렬 $A$, $n \times p$ 행렬 $B$, $m \times p$ 행렬 $M$에 대해
  
    $$
    \mathbf{M}=\mathbf{A}\mathbf{B}
    $$
  
  - 곱셈은 $A$의 열수와 $B$의 행수가 같은 경우만 정의되어 있고 결과 행렬인 $M$은 $A$의 행수, $B$의 열수가 됨
  - 행렬 M의 요소
  
    $$
    e_{ij} = \sum_{k=1}^n a_{ik}b_{kj}(i = 1\cdots m, j = 1\cdots p)
    $$
  
  - 벡터의 내적에 필요한 계산과 일치
  - 교환법칙은 성립하지 않으며 결합법칙은 성립
  
- 전치행렬
  - $m \times n$ 행렬 $M$에서, $M$의 $i$행 $j$열 요소 $m_{ij}$와 $j$행 $i$열 요소 $m_{ji}$를 바꿔넣은 $n \times m$ 행렬을 나타내고 $\mathbf{M}^\mathbf{T}$로 표기
  - 행렬 $M$이 단위행렬 등의 대각행렬일 경우
  
    $$
    \mathbf M^\mathbf{T} = \mathbf M
    $$
  
  - 행렬 $M$의 전치행렬을 다시 전치하면 원래 행렬이 됨
  
    $$
    (\mathbf{M}^\mathbf{T})^\mathbf{T}=\mathbf{M}
    $$
  
  - 행렬 $M$, $N$의 곱에 대해
  
    $$
    (\mathbf{M}\mathbf{N})^\mathbf{T}=\mathbf{N}^\mathbf{T}\mathbf{M}^\mathbf{T}
    $$

- 역행렬
  - 행렬 $M$과의 곱이 단위행렬 $I$인 행렬
  
    $$
    \begin{aligned}
    \mathbf{M}\mathbf{M}^{-1}&= \mathbf{M}^{-1}\mathbf{M}= \mathbf{I}\\
    \mathbf{I}^{-1}&=\mathbf{I}
    \end{aligned}
    $$
  
  - 전치행렬과 마찬가지로 다음과 같은 성질이 성립
  
    $$
    \begin{aligned}
    (\mathbf{M}^{-1})^{-1}&=\mathbf{M}\\
    (\mathbf{M}\mathbf{N})^{-1}&=\mathbf{N}^{-1}\mathbf{M}^{-1}\\
    (\mathbf{M}^\mathbf{T})^{-1}&=(\mathbf{M}^{-1})^\mathbf{T}
    \end{aligned}
    $$
  
- 행렬과 벡터의 곱셈
  - $n$차원 행벡터 $v$에 행렬 $M$의 곱해 $vM$에의 행렬 $M$은 $n$행이어야만 하고, 결과로서 $n$차원 행벡터 $u$를 얻으려면 $M$은 $n$열이고, $n \times n$인 정사각행렬이어야함
  - 역으로 $Mv$를 구하려면 $v$는 열벡터여야만함
  
    $$
    (\mathbf{v}\mathbf{M})^\mathbf{T}=\mathbf{M}^\mathbf{T}\mathbf{v}^\mathbf{T}
    $$
  
  - 분배법칙이 성립함
  
    $$
    (\mathbf{u}+\mathbf{v})\mathbf{M}=\mathbf{u}\mathbf{M}+\mathbf{v}\mathbf{M}
    $$
  
  - 복수의 행렬 $M$, $N$, $P$를 벡터 $v$에 차례로 곱할 때에
  
    $$
    (((\mathbf{v}\mathbf{M})\mathbf{N})\mathbf{P})^\mathbf{T}=\mathbf{P}^\mathbf{T}(\mathbf{N}^\mathbf{T}(\mathbf{M}^\mathbf{T}\mathbf{v}^\mathbf{T}))
    $$
  
- 스위즐 연산
  - 대상 벡터의 임의의 성분을 임의의 순서로 뽑아내 나열하는 연산
  - 벡터 연산을 위해 CPU에 내장된 SIMD(single instruction multiple data) 명령 세트와 GPU 프로그래밍을 위한 셰이딩 언어에 주로 사용됨
  
- 행우선과 열우선
  - 행렬은 메모리상의 1차원 배열에 그 요소가 저장되고 이때 1행씩 혹은 1열씩 나열해나갈지 방식이 정해짐
  - 행우선(row major) 방식에서는 행렬의 1행씩 1차원 배열에 채워지고 열우선(column major) 방식에서는 1열씩 1차원 배열에 채워짐
  - 유니티의 Matrix4x4 클래스는 열우선 방식임
  
- Aos와 SoA
  
  $$
  \begin{bmatrix}
  x_0 & y_0 & z_0 & w_0\\
  x_1 & y_1 & z_1 & w_1\\
  x_2 & y_2 & z_2 & w_2\\
  x_3 & y_3 & z_3 & w_3
  \end{bmatrix}
  $$
  
  1. AoS(Array of Structures)
     - 행우선으로 처리한다면 $x_0$, $y_0$, $z_0$, $w_0$이라는 4가지 다른 데이터 종류의 데이터를 가진 구조체를 요소로 하는 배열의 요소를 차례로 처리해나가게 됨
     - 이때 분산된 메모리 주소를 읽기/쓰기 해야 하므로 메모리에 랜덤하게 액세스하게 되어 성능이 저하되고 불필요한 공간이 발생할 수 있음
  2. SoA(Structures of Array)
     - 열우선으로 처리할 경우 $x$라는 같은 종류의 데이터를 여러 개 모아 $(x_0, x_1, x_2, x_3)$처럼 배열/벡터로서 각 성분에 같은 연산을 적용하여 일괄처리할 수 있음
     - 단 랜덤 액세스가 많이 발생하면 캐시스래싱(cache thrashing : 캐시 내용의 교체가 빈번하게 일어나 캐시를 사이에 두는 의미가 손상되는 것)이 일어나 성능이 저하됨
  
- 행렬식
  - 정사각행렬을 수식으로 간주해 스칼라 값을 가짐
  - 행렬 A의 행렬식은 $ det(A) $ 또는 $\lvert A\rvert $로 표기
  - 행렬식의 성질
    1. 두 개의 행 또는 열을 교환하면 부호가 반전
    2. 행렬의 어떤 행이나 열을 상수배하면 행렬식 자체가 같은 상수배(선형성)
    3. $\lvert I\rvert=1$
    4. $\lvert A^T\rvert=\lvert A \rvert$
    5. $\lvert A^{-1}\rvert=\dfrac {1}{\lvert A\rvert}=\lvert A\rvert^{-1}$
    6. $\lvert A\rvert\lvert B\rvert=\lvert AB\rvert$
  - 여인수(cofactor) 전개
    - $i$행 $j$열 요소를 $a_{ij}$로 하는 $n \times n$ 행렬 $A$에서 $i$행과 $j$열을 제거한 $(n - 1)\times(n-1)$ 행렬의 행렬식을 소행렬식(minor)라고 부르고, $M_{ij}$로 나타냄
      - 여인수 $C$는 $C_{ij}=(-1)^{i+j}M_{ij}$로 표현됨
  
    $$
    \lvert{A}\rvert=\sum_{i=1}^n(-1)^{i+j}\ a_{ij}\ \mathbf{M}_{ij}=\sum_{j+1}^n(-1)^{i+j}\ a_{ij}\ \mathbf{M}_{ij}
    $$
  
    - 2차원 행렬식
      - $(0, 0)$,  $(a_{11},a_{12})$,$(a_{21},a_{22})$, $(a_{11}+a_{21},a_{12}+a_{22})$를 정점으로 하는 평행사변형의 면적과 같음
  
      $$
      \lvert{A}\rvert=\begin{vmatrix}
      a_{11} & a_{12}\\
      a_{21} & a_{22}
      \end{vmatrix}=a_{11}a_{22}-a_{12}a_{21}
      $$
  
    - 3차원 행렬식
      - 각각 $a_1$, $a_2$, $a_3$이라는 벡터들에 의해 생기는 평행육면체(parallelepiped)의 체적과 같음
  
      $$
      \begin{aligned}
      \lvert{A}\rvert&=\begin{vmatrix}
      a_{11} & a_{12} & a_{13}\\
      a_{21} & a_{22} & a_{23}\\
      a_{31} & a_{32} & a_{33}
      \end{vmatrix}\\
      &= a_{11}a_{22}a_{33}-a_{11}a_{23}a_{32}-a_{12}a_{21}a_{33}\\
      &+a_{12}a_{23}a_{31}+a_{13}a_{21}a_{32}-a_{13}a_{22}a_{31}
      \end{aligned}
      $$
  
      - 벡터 $a = (a_x, a_y,a_z)$와 $b =(b_x,b_y,b_z)$의 외적 $a \times b$는 좌표계의 기저를 $i,k,j$라고 했을때
  
      $$
      \mathbf{a}\times\mathbf{b}=\begin{vmatrix}
      i & j & k\\
      a_x & a_y & a_z\\
      b_x & b_y & b_z
      \end{vmatrix}
      $$
  
- 직교행렬
  - 정사각행렬 $\mathbf{M}$과 그 전치행렬 $\mathbf{M}^\mathbf{T}$의 곱이 단위행렬 $\mathbf{I}$가 되는 행렬
  
    $$
    \begin{aligned}
    \mathbf{M}^\mathbf{T}\mathbf{M}&=\mathbf{M}\mathbf{M}^\mathbf{T}=\mathbf{I}\\
    \mathbf{M}\mathbf{M}^{-1}&=\mathbf{M}^{-1}\mathbf{M} = \mathbf{I}\\
    \mathbf{M}^\mathbf{T}&=\mathbf{M}^{-1}
    \end{aligned}
    $$
  
  - 직교행렬의 행렬식은 1 또는 -1
  
    $$
    \begin{aligned}
    \lvert\mathbf{AB}\rvert&=\lvert\mathbf{A}\rvert\lvert\mathbf{B}\rvert\\
    \lvert\mathbf{M}^\mathbf{T}\mathbf{M}\rvert&=\lvert\mathbf{M}\rvert^\mathbf{2}
    =\lvert\mathbf{I}\rvert = 1
    \end{aligned}
    $$
  
  - 직교행렬 중 행렬식이 1이 되는 것을 특수직교행렬(special orthogonal matrix)라고 함
