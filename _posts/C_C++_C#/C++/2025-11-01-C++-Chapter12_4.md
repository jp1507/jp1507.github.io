---
title: "[C++] Chapter 12.4 가상 소멸자"
date: 2025-11-04 13:44:00 +0900
categories: ["C, C++, C#", C++]
tags: [programming, cpp, 프로그래밍, C++]
series: "따라하며 배우는 C++"
series_order : 106
math: true
image:
  path: https://imgur.com/Eqg7DeC.jpg
---

## Chapter 12. 가상 함수 : 가상 소멸자

### 가상 소멸자 사용 전

---

```cpp
#include <iostream>
using namespace std;

class Base
{
public:
    ~Base()
    {
        cout << "~Base()" << endl;
    }
};

class Derived : public Base
{
private:
    int* m_array; 
public:
    Derived(int length)
    {
        m_array = new int[length];
    }

    ~Derived()  
    {
        cout << "~Derived()" << endl;
        delete[] m_array;
    }
};

int main()
{
    Derived derived(5);
    return 0;
}
```

```text
- 출력 -

~Derived()
~Base()
```

- 생성자 호출 순서와 반대로 소멸자는 자식부터 호출되고 그 다음 부모 소멸자가 호출됨

```cpp
int main()
{
    Derived* derived = new Derived(5);
    Base* base = derived;
    delete base;

    return 0;
}
```

```text
- 출력 -

~Base()
```

- `delete base`에서 `base`는 자식인 `derived` 객체를 참조하고 있는데 이때 `base`를 할당 해제시켜주면 `Derived` 소멸자는 호출되지 않고 부모인 `Base`의 소멸자만 호출됨
- 위와 같이 부모를 지우면 부모 소멸자만 호출되며 자식 소멸자는 호출되지 않으므로 소멸자도 자식들의 소멸자를 각각 호출해줘야 함

### 가상 소멸자 virtual

---

- 소멸자에 `virtual`을 붙이면 부모 타입으로 자식 객체를 참조해도 자식 객체의 소멸자를 호출시킴

```cpp
#include <iostream>
using namespace std;

class Base
{
public:
    virtual ~Base()
    {
        cout << "~Base()" << endl;
    }
};

class Derived : public Base
{
private:
    int *m_array; 
public:
    Derived(int length)
    {
        m_array = new int[length];
    }

    ~Derived()  
    {
        cout << "~Derived()" << endl;
        delete[] m_array;
    }
};

int main()
{
    Derived* derived = new Derived(5);
    Base* base = derived;
    delete base;

    return 0;
}
```

```text
- 출력 -

~Derived()
~Base()
```

- `B`에 가상 소멸자를 설정했으므로 `delete base;`에서 정상적으로 자식 소멸자부터 호출됨

```cpp
~Derived() override
{
    cout << "~Derived()" << endl;
    delete[] m_array;
}
```

- 자식 소멸자에 `override`를 붙일 수 있는데 이 경우 꼭 부모 소멸자에 `virtual` 키워드를 붙여야 함
- 부모 소멸자가 가상 소멸자가 아니라면 자식 소멸자에 `override`를 사용할 수 없음
