---
title: "[C++] Chapter 6.10 메모리 동적 할당"
date: 2025-10-22 16:34:00 +0900
categories: ["C, C++, C#", C++]
tags: [programming, cpp, 프로그래밍, C++]
series: "따라하며 배우는 C++"
series_order : 37
math: true
image:
  path: https://imgur.com/Eqg7DeC.jpg
---

## 동적 메모리 할당

---

- 필요할 때만 메모리를 할당받아서 사용하고 반납할 수 있음
  - 지역 변수나 배열은 스코프를 벗어나면 메모리에서 사라지므로 여러 함수에서 사용하기 부적합
  - 전역 변수나 배열은 여러 함수에서 사용할 수 있지만 프로그램이 종료될 때까지 메모리를 점유해 공간 비효율 발생
  - 동적으로 메모리를 할당 받으면 필요할 때 스코프 범위에 구애받지 않고 사용 후 반납할 수 있음
- 실행 중에 사용될 메모리 양은 컴파일 타임에 미리 예측하기 힘듦
  - 정적 배열의 경우, 배열의 크기를 미리 컴파일 타임에 알고 있어야 메모리를 할당 받을 수 있으므로, 의도적으로 배열 크기를 크게 잡아 공간 비효율 발생
  - 동적 할당을 받은 배열의 경우 크기를 실행 중에 결정
- 동적 메모리 할당을 OS에 요청하면 **힙 메모리** 중 유후 영역을 할당해줌
  - 정적 할당은 **스택 메모리**에 할당되는데 힙 메모리가 스택 메모리보다 훨씬 큼
- 실행 중에 할당 받으므로 시간 지연이 발생하며 성능 저하가 있을 수 있음
  - 정적 할당은 프로그램이 실행되기 전 컴파일 타임 때 미리 할당 받은 공간을 그대로 사용하므로 시간 지연이 없음
- 개발자가 수동으로 메모리를 해제하고 반납해야함
  - 그렇지 않으면 메모리 누수가 발생할 수 있음
- 기본적으로 정적 할당을 사용하고 실행 중에 결정되는 정보에 한해 동적 할당하여 사용

## 동적 메모리 할당 new

---

```cpp
int* ptr = new int;
*ptr = 7;

/*
int var;
var = 7;
*/
```

- `new` 키워드를 이용해 해당 데이터 타입 크기만큼 힙 메모리를 할당 받아온 뒤 주소를 반환

## 동적 메모리 해제 delete

---

```cpp
int* ptr = new int;
int* ptr2 = ptr;
delete ptr;
```

- `delete` 키워드로 동적 할당 받은 포인터 변수의 메모리를 해제하고 반납함
  - `ptr`의 값은 주소 값이므로 변함 없음
  - `*ptr`의 경우 가리키고 있는 값에 쓰레기 값이 들어있음
    - 가리키는 영역이 없어졌기 때문에 간접 참조할 수 없게 됨
- 메모리 해제 후 `nullptr`을 대입해 아무 영역을 가리키지 않게 해줌

## 메모리 누수

---

```cpp
while (true)
{
  int* ptr = new int;
  cout << ptr << endl;
}
```

- 메모리 누수(memory leak)는 동적 할당 받은 변수가 해제되지 않고 가리키는 주소가 바뀔 경우 어떠한 변수도 가리키지 않고 공간만 차지하는 가비지가 됨
- 매 반복 기존의 `ptr`이 사라지고 새로운 `ptr`을 할당 받으므로 기존의 할당 받은 영역이 가비지가 되버림
- 이렇게 가비지가 쌓이면 메모리 누수 문제가 발생함
